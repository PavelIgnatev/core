const { MongoClient } = require('mongodb');

let db;

const DB = async () => {
  while (!db) {
    try {
      const client = new MongoClient(
        'mongodb://gen_user:35B%3DR9GTC%5Cq.Xv@82.97.255.185:27017/core?authSource=admin&directConnection=true'
      );
      const connect = await client.connect();
      db = connect.db('fucker');
      break;
    } catch {}
  }

  return db;
};

const getAccountCollection = async () => {
  return (await DB()).collection('accounts');
};

const insertAccount = async (account) => {
  const accountCollection = await getAccountCollection();

  await accountCollection.updateOne(
    { accountId: account.accountId },
    { $set: account },
    { upsert: true }
  );
};

const accountsString = `567a35c701c2353642c7d73b4500d6a82e92dd9d9beb4bb06c5a1f9ee2075a4320f991be97d1f4e8096e1aa7e7a481d13dd24ca7fb2c7d832ef079daf62d1771a1cb6a3dc10b740a801ec584ba04575ffc4a7b308331137ff766819f6069335792140d1b3360de39eaccdfcb2d531c677a5a9552278432702e1cee0d6e2aac0c49c0b3f880415d5ab49dc401b2212f8f5de63503665b377a0ef065f55fe144d071d61b82eadac35fb9d276dd698d4efccfc97a783852c5cb2afdaf42fc8d75ad00f68888415209a3dff20cfb2c481ae43884f906805ea0230dfe5256bb1f2f937dcb8efb7237da2f4f76bc1a74903cf0a7185ea8d2dfee340aec682c57299002:2
20753f5ebe29cccbadcad292a615b477c41898e2c358c5a27fd672c0c06ad95f13ddc7b440f364b109c07cb83ed3ebcf370c7f75f88e07a3ac92ef09258fbe882f956a59ecaf0f40b031626b4357d490b881417c751a2540424717b2abfd2063b5d1f4ab86759e4d9224933c611aed4d8b22d5aa85fede2141aa3e04377f4310c8732bf4a3697fcaa6ec02697ad1a63163fda4a61ea366b78a19f975030166d72f189a7a3e1dcc8947ec9dc7fec15c5d29b7bfc0daf2786cdf6e60f616506080a4806512c10b557c4479a648e517169d2a2f9ed9fd8570537e639cce357e70b022ed421b28e15563d6280bbc03a3babacbd81d671d98429d5fdd13016b49ae6b:2
b3e07f45bdd2ad20d2fa967269092560561e0025b2b99a14a2e290aa968f17f74c92ce0cc808de0d43b4cdaf3ee7f9db0a31eb1cdf59c55f76694ccb2d6756aaed42d4bdc9b5bd10afe4687389b7ada3d9531fe6f0d54f9beff747715f952572fd8ce11cf5ee6608f0207258ccce8817c778eaa81adcd7633886e8f51244268e76750dcab9e95370460529ccf6168de6c68a557f0ab2c421a15a226c4f7d3f56f9a0c272819a280b92da72c70a80a97496064a17ac619f7a57d1ceafa65ac609b4d4fe49138418fb5717ceb6b6a8e04501d4196c563bacc91a485aed2b685a7e88b01a07e1956f3a2d6cb63ce428d294bfdbc4386136c050605753bd16a83e08:2
b1a6771849d321885d7f7d1f6540105491472a9d83c01569da96fa3c458abeb065190badcf30a4fc0fb83f24579526ae2385d2d62cc79d0130c1568e4338c130d66cb7ee7fe9ef4bdcc2e573a4c0ecb536d239d39f1ed57fe83868281f900bc871c025cff2077b38f173f4ee0678ecb0ea1a7a9d2b2c27c4f6b789a137882073ef8c65bd7e5e51bbd8f50a9f01607f5aa235a092fada79f4b29631a939278db14c6f18929d5207f03520850de6c91f4a6660711913a2c262e97489f9620c59e010ade8509b6fecf9bbe39acdeaa33fa8abd8c95371314a84a4af09c3352361ec49a1a9e574d0381ea98b5f664d8a1854b6ee064291bbdba1ecde3504758dd27c:2
89e6911680fe1dbe5fb618d49b8371142726e10adf4923d330105ec74d451cc2a10588b17499d865e06971eab48230e11fd974ff86c9d5d28507989d7ffe9bb00c44432d8b733bf0ec1636f834ecb9ca86a5d02140b118e29292154f4fc44264d3d604995323380a78fe103efbfd48a5ec9212bd99fbace64db7d9da3bae684eaf693417c1979058fa72b8e96763386ad101d9ee669a08d94ee46104421bccf093fa49103100d89c4babf47dc972632925e75010d69a477a694c860fb29e17ba6e01c23f10d65c0022308ed12d35a28dc4321eed52ec571572217c060196748fef1cbd723bb51c8be5e9973bf2500a4c11ce6a3f7243a0a72cd64f0e68fe7fde:2
2d44c987367395b29e22ff3e17b61df5e88f1ac9f14ab1944bfcf219a5ec142c4c4eed0b2ba791ff85f57963892d1b0e2f893720f426d697922471c9316fa6dd9384194ccde3e72991421c17f00cc9d41446decb63df92980209042df8ddd674dde10bca63420aef346c386327812f3f9d052bdae2320280ad7aa4d1cc0be4b5fdc22cbe3105caa58254606027119ec93b07cca67f3b7f814f43e6c6ca1a6a664829142a9d1d8300f40355ecc226d9a202e827e08e43fb8e76144fae007efda0b5ca3e1826c9ca43128aaa916a56cd6c4c134445c10fd63f83cf97fea3e85357077fb392f50b3f6fc0d9777e4b30fe2fd5c41c533c9ce7a9061c6d4d5f9c489d:2
6f26e59fd38a1d285949bf67ab9bdca837d472d1ab8fb17b4e777d4354f63cb677b849caf09c882567c1c418cef6f43559815fb4b26a247fe438743b9a5ce34c14413016b873c396c277154159ba80a6c80093d01bc71099d15f97de1c4cf17cf7a05261784b985ca749f009ed532219ed3e7f805c83b1199798ec30247ed929859e2fd7cc5ddd3d6ab4c3a67afafe533aeb645db534843b04ed074835db263b3bc3ca771ac9ed3fcd95ecf68c310d6a3f4cdd3908d8d6b42b16e2b982a7c8d3a557d96722cff39256777ec1ea7aadcaeaf9a9960745041a9a87847edc0e9ad3eacc728d0069ae2e81caee2cfd3a8e4dce3539ede3d8b889c73b4afae623afdd:2
2c92597838f23530d2540fe15ca7400ac2778a6c4f3f8886a6cd3f458aa035c96b4159ecb70ff4a5f3ef2f9919ce8fae9e656cf7486159b51fede82d66ee4c9af7639f80b1b91b9c6d87b8eb3ab44e9463261368b7bda14de10e940409d74efb766498b7a37d700b23b8a768e38b706135f5b9d2bcbd2d5fffe1d830e32bdc6c362f7dab91769d3251df1e1c0c9248e76ab7446c41175c1ac97b09af9ee32bd14b330bb05b63ee14e1e4ed6185c5dc5b7f4b1b511b2432503a56111f68d74b638d56012ecf4705d855055193277122ae35e2a5819a42896f299373567538d45b78492f209d9ee4af71aa98c587ed5bc6ecb07a4a69723a8e9a339d5467fe0aec:2
c00b63403fc2cf2ec8f76185a8c1e79af573035b0797907de8b8244909f7709e03ca1d18e7b4874e70ce4b9fdb35f47ae1bafe87deeabd0e9936731b7f32c18cb274a8f37c9b06fd865b43d3de9746a2c35a2ca351fd08df536c33ea4b8a8b15b8b5dc45241c4e91b242652a0307344d0cf04935925e25369e49792ec89165f6d1c6b0c508b819684dcd3b84b111dc3b1bfba5e261940a98cafda278dc65242c23f5822f70d8b29775b968ae09b02cbf57e84a167baad794b9ddf7740c0c9da71abfef1bc65d32ea7cb7034554eddfe55c51580f8bcbb1a26daf64eb75da29c3bfc70d6ec94758a64536b836a6803df7594bc05e5a7b30ca10280ff9dc1d892c:2
965a478fef3bfc7244987a46683c4cd7f698d2a027f90d0ab3d6ed2a600695e850f2b7838417bf9eda40c9eb67385fa441cb55711ded611b47f47a6cb247c6834a681bffeb9268785d630e44e2b27b32e9849336d409befd5e45d42ab07d005d67c1affe973b864efbd34fc7fd89a92b00ece35d97b0c80e821138dc1773faee88b7ee41b0c3bc096f0dc40d9ceb90aa11a39e366e7efba2a5eb2e9be4daa1fdb2e2aa5b6cb2446162fd8e83752913f30252ba3154900110d992d191b7c6a1772a1b932eb4a198a4abae6a53428f136757fdbbf5aab089fc52606b9c0a5b33bdb9e71e3de52695b8678e6f54746bac3e54a86380ee4b06b18072bc20f30cb4b3:2
0c624b31b41e488bbdd4fe3c8f215d6b7db6b83caa114b90fa0481f8fb47d3d7681bd36c698d630572c4bb19ea9207c98e95d2c6a4648f83c8d26dededbf4879e89df4ad4010dfe580f561771785df006c96d46934280ed232cf686da1b35a659d006c2c6372eb99addcee49f0ae39707e769057c366fd8f2dc41582d30196869e89e636972e02ed1a207b1d5bab5d661ee1457b0629d313a2cb6ce94e212c7a2b57fb97058abef0235347eafb04d9ac560cd7a52ad15967ea87039aed3541188592b639c1bbab9abe6ec6d9bc8c24689c3c9ab39a5bf01af986ec922ad3fe10131ecdf97ee1b3dc04e16cfdc231d250f3eb868e4dc39af50937e3908fa383b6:2
094407f5902a77909049e5d028dad15ce9329d52a62dd4f0ac4998158a7cce2ef5fa2e3bceca517fd9192dd6e7789a55656785867c28e7a7e6dbf81ae963905af68a0d671c26642099655ef2de35270f7d07f4ee7c5288778d8c71b9c0346b4d242160a48f7a199e0cdb53e301a904d48e2c1325a96a7bc91f2f5d6724c7005e168d528357300729174afffeed863efe993a2bbaaeeccc61e06025d9f8397aff855ce36288bb191deab7b692d246a02c2580a5a5c41f8bc7996139d452ae95d8e31df4793f1d12ae31d5da9c6742c8a050f2dd62881892155f7abf45e414ee4d6531f8aa1654e1c4e8423f715a17bb02976bc398012d87d601fdbafec0197b37:2
64985a96a0c04137b3ca4e02e0cd6598e27b25c0c45a640af5c242ae97ddb73224ecc3ec12c1785a7245a03a855256cd36ddc42241ba7f551c4ad3e295720423b83c371921cbb950b8303ee5c8804d8e61c7b7fb97be647c9dd3f1e3fa05507e369a9746319f57c57c106b7a65cbb538ae27353e4281f6539821d7aca776316ca6826de80456d81c80b7269daab6a20a857816a26c3c05b345261d12fe6e8188f552ff798b09b1075e0fff32ae7c1df95b9c4776b9480f59c313ad885952312dc1e271a5253caebc3c34a2fd0d644990b7cf383147871f084c05d04bf2cd809b511a1a6d9606cad1df55c15623a71b9e5c97834411a39e5430161527fc58db10:2`

//  .map((e) => `${e[`dc${e.dcId}`]}:${e.dcId}`)
// .join('\n'))
const accounts = accountsString
  .split('\n')
  .filter(Boolean)
  .map((a) => {
    const s = a.split(':');

    return { authKey: s[0], dcId: s[1] };
  });

const zanos = async () => {
  try {
    for (const account of accounts) {
      const username = account.authKey.slice(0, 32);

      const data = {
        accountId: username,
        dcId: Number(account.dcId),
        prefix: 'test-govna',
      };

      data[`dc${account.dcId}`] = account.authKey;
      await insertAccount(data);
    }
    console.log('VSE');
  } catch (error) {
    console.error('Ошибка при обработке файлов:', error);
  }
};

// Вызываем функцию zanos
zanos().catch((error) => {
  console.error('Ошибка в функции zanos:', error);
});
